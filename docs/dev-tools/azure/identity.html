<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft Identity | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Things related to Microsoft Identity, AAD, etc.">
    <meta property="og:url" content="/dev-tools/azure/identity.html">
    <meta property="og:site_name" content="Marcin Jahn | Technology Notebook">
    <meta property="og:title" content="Microsoft Identity">
    <meta property="og:description" content="Things related to Microsoft Identity, AAD, etc.">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Technology Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.03266277.css" as="style"><link rel="preload" href="/assets/js/app.466fed30.js" as="script"><link rel="preload" href="/assets/js/2.33694ec6.js" as="script"><link rel="preload" href="/assets/js/30.e7533191.js" as="script"><link rel="prefetch" href="/assets/js/10.b99f54f9.js"><link rel="prefetch" href="/assets/js/100.688e5dc5.js"><link rel="prefetch" href="/assets/js/101.d3f462a9.js"><link rel="prefetch" href="/assets/js/102.9459e805.js"><link rel="prefetch" href="/assets/js/103.321ab79e.js"><link rel="prefetch" href="/assets/js/11.523fab90.js"><link rel="prefetch" href="/assets/js/12.791687fa.js"><link rel="prefetch" href="/assets/js/13.77672cd0.js"><link rel="prefetch" href="/assets/js/14.a3ffb52a.js"><link rel="prefetch" href="/assets/js/15.de01d96e.js"><link rel="prefetch" href="/assets/js/16.df90b0e4.js"><link rel="prefetch" href="/assets/js/17.73ab13d3.js"><link rel="prefetch" href="/assets/js/18.3381a89c.js"><link rel="prefetch" href="/assets/js/19.3196e9f1.js"><link rel="prefetch" href="/assets/js/20.eb275b88.js"><link rel="prefetch" href="/assets/js/21.8307e09e.js"><link rel="prefetch" href="/assets/js/22.32c3d6e0.js"><link rel="prefetch" href="/assets/js/23.f2d1ac29.js"><link rel="prefetch" href="/assets/js/24.6d24553f.js"><link rel="prefetch" href="/assets/js/25.208f6bc3.js"><link rel="prefetch" href="/assets/js/26.178d6918.js"><link rel="prefetch" href="/assets/js/27.71ddd835.js"><link rel="prefetch" href="/assets/js/28.e3b943b9.js"><link rel="prefetch" href="/assets/js/29.69c54bd4.js"><link rel="prefetch" href="/assets/js/3.a0137e6d.js"><link rel="prefetch" href="/assets/js/31.a2557726.js"><link rel="prefetch" href="/assets/js/32.9d7be523.js"><link rel="prefetch" href="/assets/js/33.0b5ef82c.js"><link rel="prefetch" href="/assets/js/34.7a7f6b9b.js"><link rel="prefetch" href="/assets/js/35.04ac5ccd.js"><link rel="prefetch" href="/assets/js/36.87ecd1f0.js"><link rel="prefetch" href="/assets/js/37.8c267d50.js"><link rel="prefetch" href="/assets/js/38.5c5889b0.js"><link rel="prefetch" href="/assets/js/39.328dea94.js"><link rel="prefetch" href="/assets/js/4.9493be73.js"><link rel="prefetch" href="/assets/js/40.1d8ed794.js"><link rel="prefetch" href="/assets/js/41.1b7a07a4.js"><link rel="prefetch" href="/assets/js/42.36ea0f23.js"><link rel="prefetch" href="/assets/js/43.d864b5ba.js"><link rel="prefetch" href="/assets/js/44.17682958.js"><link rel="prefetch" href="/assets/js/45.5e44583a.js"><link rel="prefetch" href="/assets/js/46.586a715d.js"><link rel="prefetch" href="/assets/js/47.60433c82.js"><link rel="prefetch" href="/assets/js/48.31e9e5ab.js"><link rel="prefetch" href="/assets/js/49.60afa383.js"><link rel="prefetch" href="/assets/js/5.8aec15e3.js"><link rel="prefetch" href="/assets/js/50.e08c8adc.js"><link rel="prefetch" href="/assets/js/51.444f2283.js"><link rel="prefetch" href="/assets/js/52.2d012cec.js"><link rel="prefetch" href="/assets/js/53.53e8cb2e.js"><link rel="prefetch" href="/assets/js/54.017d444a.js"><link rel="prefetch" href="/assets/js/55.d4bb89f4.js"><link rel="prefetch" href="/assets/js/56.bfebc7b8.js"><link rel="prefetch" href="/assets/js/57.6ad0df9e.js"><link rel="prefetch" href="/assets/js/58.58a85cbb.js"><link rel="prefetch" href="/assets/js/59.6a7b49ac.js"><link rel="prefetch" href="/assets/js/6.92f6dc05.js"><link rel="prefetch" href="/assets/js/60.7cb3203d.js"><link rel="prefetch" href="/assets/js/61.859b4d95.js"><link rel="prefetch" href="/assets/js/62.3bc887da.js"><link rel="prefetch" href="/assets/js/63.01075aef.js"><link rel="prefetch" href="/assets/js/64.aff7e5b5.js"><link rel="prefetch" href="/assets/js/65.cde54ed1.js"><link rel="prefetch" href="/assets/js/66.10cc3c09.js"><link rel="prefetch" href="/assets/js/67.6cbed091.js"><link rel="prefetch" href="/assets/js/68.bbeb8505.js"><link rel="prefetch" href="/assets/js/69.cac95602.js"><link rel="prefetch" href="/assets/js/7.0c0dcf66.js"><link rel="prefetch" href="/assets/js/70.c308535d.js"><link rel="prefetch" href="/assets/js/71.4f48db50.js"><link rel="prefetch" href="/assets/js/72.a99d23d5.js"><link rel="prefetch" href="/assets/js/73.d95c05e8.js"><link rel="prefetch" href="/assets/js/74.5c9b75cd.js"><link rel="prefetch" href="/assets/js/75.b35d06ad.js"><link rel="prefetch" href="/assets/js/76.17b4b552.js"><link rel="prefetch" href="/assets/js/77.fde2fd10.js"><link rel="prefetch" href="/assets/js/78.10a3234f.js"><link rel="prefetch" href="/assets/js/79.a287839a.js"><link rel="prefetch" href="/assets/js/8.65d70dfa.js"><link rel="prefetch" href="/assets/js/80.d8e93c27.js"><link rel="prefetch" href="/assets/js/81.f40949ee.js"><link rel="prefetch" href="/assets/js/82.2dd44cba.js"><link rel="prefetch" href="/assets/js/83.a42c0496.js"><link rel="prefetch" href="/assets/js/84.0fcb0939.js"><link rel="prefetch" href="/assets/js/85.687d3005.js"><link rel="prefetch" href="/assets/js/86.b9960fc4.js"><link rel="prefetch" href="/assets/js/87.1f7fd564.js"><link rel="prefetch" href="/assets/js/88.f939f62c.js"><link rel="prefetch" href="/assets/js/89.9d173143.js"><link rel="prefetch" href="/assets/js/9.710b74ab.js"><link rel="prefetch" href="/assets/js/90.d619dec4.js"><link rel="prefetch" href="/assets/js/91.f3eb82bd.js"><link rel="prefetch" href="/assets/js/92.e9121590.js"><link rel="prefetch" href="/assets/js/93.de9d74b9.js"><link rel="prefetch" href="/assets/js/94.9ec8bc1c.js"><link rel="prefetch" href="/assets/js/95.e9ad8ba2.js"><link rel="prefetch" href="/assets/js/96.34069385.js"><link rel="prefetch" href="/assets/js/97.98863609.js"><link rel="prefetch" href="/assets/js/98.3d440706.js"><link rel="prefetch" href="/assets/js/99.96de4fbf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03266277.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/technology-notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/technology-notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev-tools/" aria-current="page" class="sidebar-link">/dev-tools/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Azure</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev-tools/azure/azure-table-storage.html" class="sidebar-link">Table Storage</a></li><li><a href="/dev-tools/azure/identity.html" aria-current="page" class="active sidebar-link">Microsoft Identity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev-tools/azure/identity.html#access-token-vs-id-token" class="sidebar-link">Access Token vs. ID Token</a></li><li class="sidebar-sub-header"><a href="/dev-tools/azure/identity.html#b2x" class="sidebar-link">B2X</a></li><li class="sidebar-sub-header"><a href="/dev-tools/azure/identity.html#multi-tenant-apps" class="sidebar-link">Multi-tenant Apps</a></li><li class="sidebar-sub-header"><a href="/dev-tools/azure/identity.html#app-registration-vs-service-principal" class="sidebar-link">App Registration vs. Service Principal</a></li><li class="sidebar-sub-header"><a href="/dev-tools/azure/identity.html#app-registrations" class="sidebar-link">App Registrations</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="microsoft-identity"><a href="#microsoft-identity" class="header-anchor">#</a> Microsoft Identity</h1> <h2 id="access-token-vs-id-token"><a href="#access-token-vs-id-token" class="header-anchor">#</a> Access Token vs. ID Token</h2> <p>OAuth2 protocol is used for <strong>authorization</strong> - to allow apps to get access to
users' resources without having the actual users' credentials to these
resources. Instead, the app gets permission to retrieve an access token that
grants access to some resource.</p> <p>ID Token is similar, but it's used for <strong>authentication</strong>. Another difference is
that the access tokens are to be used by:</p> <ul><li>identity providers (that issue them)</li> <li>resources (that give access to some data (or not) based on claims in the
tokens)</li></ul> <p>The apps that read that data for the users are not supposed to look into the
access tokens (and they are not the <em>audience</em>)! However, they are allowed and
expected to read the ID Tokens to learn who the user is. The actual <em>audience</em>
of the ID Token is the app that is supposed to display user's name.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Microsoft Identity implements OAuth2 and OpenID Connect standards.</p></div> <p>Access Token cannot contain permissions for multiple different services. One
access taken can have multiple permissions, but only in scope of a single
resource.</p> <h2 id="b2x"><a href="#b2x" class="header-anchor">#</a> B2X</h2> <h3 id="b2b"><a href="#b2b" class="header-anchor">#</a> B2B</h3> <p>AAD tenant may invite users that are not part of the organization. Such users
would have <em>shadow accounts</em> created for the needs of business cooperation.
Admin of a tenant might manage access of the external users via the shadow
accounts. They may be treated as guest accounts in the organization.</p> <p>Uing B2B, the app may be a signle-tenancy one. The B2B users are treated as
members of the tenant where they were invited to.</p> <p>B2B is used for cooperation between businesses when they need to work on a
single project together.</p> <h3 id="b2c"><a href="#b2c" class="header-anchor">#</a> B2C</h3> <p>Allows to federate other identity providers under a single umbrella of AAD.
Without B2C, all users have to use Microsoft accounts. With B2C the users can
use any OpenId Connect-compliant IdP.</p> <p>B2C is used to allow access to our product to users from the world, the actual
customers.</p> <h2 id="multi-tenant-apps"><a href="#multi-tenant-apps" class="header-anchor">#</a> Multi-tenant Apps</h2> <p>AAD apps that are multitenant may be logged-into by users from multiple AAD
tenants. Every tenant gets its own service principal entity for that app.</p> <h2 id="app-registration-vs-service-principal"><a href="#app-registration-vs-service-principal" class="header-anchor">#</a> App Registration vs. Service Principal</h2> <p>There is a concept of <strong>app registration</strong> (client ID) and <strong>service
principal</strong> (service principal ID).</p> <p>In single-tenant apps these are basically the same thing. There's one app
registration and one service principal of the app in a single tenant.</p> <p>In multi-tenant apps the concepts are separate. There is one app registration,
but for every tenant that has users accessing the app, there will be a separate
service principal created.</p> <p>App Registration is like a template for multiple service principals to be
created based on it.</p> <h2 id="app-registrations"><a href="#app-registrations" class="header-anchor">#</a> App Registrations</h2> <h3 id="app-roles"><a href="#app-roles" class="header-anchor">#</a> App Roles</h3> <p>App roles allow to create custom roles that the app understands and works with.
These roles can then be assigned to the users of the app. This way we can create
our own RBAC rules for the app, limiting what different users can access.</p> <p>The roles may be applied to users/apps in the Enterprise Applications panel of
AAD. A set of roles would have been created in the app registration. Each tenant
might assign different sets of people to these roles via their own service
principals (my app in their tenant).</p> <p>The assigned roles will be available in the access token.</p> <h3 id="api-permissions"><a href="#api-permissions" class="header-anchor">#</a> API Permissions</h3> <p>We can define the allowed set of permissions that the app may ask for. They may
be also consented by the admin of a tenant. With that, individual users of the
app will not be asked for consent.</p> <p>App may also ask for permissions &quot;dynamically&quot;, so the permission does not have
to be defined in <em>API Permissions</em> in AAD. In such a case, the user has to
consent the permission to allow the app to get the requested data.</p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/dev-tools/azure/azure-table-storage.html" class="prev">
        Table Storage
      </a></span> <!----></p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/marcinjahn/technology-notebook/edit/main/src/docs/dev-tools/azure/identity.md" target="_blank" rel="noopener noreferrer">Feel free to contribute to this article!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/10/2022, 6:29:45 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.466fed30.js" defer></script><script src="/assets/js/2.33694ec6.js" defer></script><script src="/assets/js/30.e7533191.js" defer></script>
  </body>
</html>
